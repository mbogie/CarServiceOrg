<apex:page standardController="Workshop__c" extensions="CsWorkshopDetailController" tabStyle="Workshop__c">

    <style>
        #map {
            width: 100%;
            height: 400px;
            background-color: grey;
        }
    </style>
 
    <apex:form id="workshopForm">
        <apex:pageMessages id="messages"/>
        <apex:pageBlock id="workshopBlock" title="{!Workshop__c.Name}">
            <apex:pageBlockSection id="detailSection" title="{!$Label.Section_Details}">
                <apex:outputField value="{!Workshop__c.Name}"/>
                <apex:outputField value="{!Workshop__c.Phone__c}"/>
                <apex:outputField value="{!Workshop__c.Website__c}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection id="addressSection" title="{!$Label.Section_Address}" columns="1">
                <apex:pageBlockSection columns="2" collapsible="false">
                    <apex:outputField value="{!Workshop__c.Address__c}"/>
                    <apex:outputField value="{!Workshop__c.City__c}"/>
                    <apex:outputField value="{!Workshop__c.Country__c}"/>
                    <apex:outputField value="{!Workshop__c.Zip_Code__c}"/>
                </apex:pageBlockSection>
                <script>
                    twistSection(document.getElementById('img_{!$Component.addressSection}'));
                </script>
                <div id="map"></div>
            </apex:pageBlockSection>
            <div id="buttonSection" align="center" draggable="false">
                <apex:commandButton value="{!$Label.Button_Edit}" action="{!edit}"/>
                <apex:commandButton value="{!$Label.Button_Delete}"
                                    onclick="if(!confirm('{!$Label.Delete_Confirm_Message}')) return false;"
                                    action="{!delete}"/>
            </div>
        </apex:pageBlock>
        <apex:pageBlock id="historyBlock" title="{!$Label.Section_History_Tracking}">
            <apex:pageBlockTable id="historyTable" value="{!Workshop__c.Histories}" var="history">
                <apex:column value="{!history.CreatedDate}"/>
                <apex:column value="{!history.CreatedById}"/>
                <apex:column value="{!history.Field}"/>
                <apex:column value="{!history.OldValue}"/>
                <apex:column value="{!history.NewValue}"/>
            </apex:pageBlockTable>
        </apex:pageBlock>
        <apex:pageBlock id="agreementsBlock" title="{!$Label.Section_Agreements}">
            <apex:pageBlockTable id="agreementsTable" value="{!agreementsForWorkshopPageFormController}" var="contract"
                                 rendered="{!(agreementsForWorkshopPageFormController.size>0)}">
                <apex:column headerValue="{!$Label.Actions_Label}">
                    <apex:commandLink action="{!dismiss}"
                                      reRender="workshopForm,messages,agreementsBlock"
                                      onComplete="refresh">{!IF(ISNULL(contract.End_Date__c), $Label.Action_Dissmiss, IF(contract.End_Date__c <= TODAY(),'',$Label.Action_Dissmiss))}
                        <apex:param name="selectedContract" value="{!contract.Id}"
                                    assignTo="{!editedContractInUse.Id}"/>
                    </apex:commandLink>
                </apex:column>
                <apex:column headerValue="{!$ObjectType.Contract__c.fields.Name.Label}">
                    <apex:outputLink value="{! URLFOR($Action.Contract__c.View, contract)}"> {!contract.Name}
                    </apex:outputLink>
                </apex:column>
                <apex:column headerValue="{!$ObjectType.Mechanic__c.fields.Full_Name__c.Label}">
                    <apex:outputLink
                            value="{! URLFOR($Action.Mechanic__c.View, contract.Mechanic__c)}"> {!contract.Mechanic__r.Full_Name__c}
                    </apex:outputLink>
                </apex:column>
                <apex:column value="{!contract.Start_Date__c}"/>
                <apex:column value="{!contract.End_Date__c}"/>
            </apex:pageBlockTable>
        </apex:pageBlock>
    </apex:form>
    <script>
        function initMap() {
            var uluru = {lat: {!lat}, lng: {!lon}};
            var map = new google.maps.Map(document.getElementById('map'), {zoom: 5, center: uluru});
            var marker = new google.maps.Marker({position: uluru, map: map});
        }
    </script>
    <script async="async" defer="defer"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhoQ14dEy_qpmaYadeaizUjiMpZwM6ObQ&callback=initMap">
    </script>
</apex:page>